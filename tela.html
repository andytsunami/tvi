<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Socket.io Demo</title>

  <style>
    .chat-form { display: none; }
  </style>
</head>
<body>

<form class="username-form" method="post" action="">
<h1>BEM VINDO, DIGITE SEU NOME:</h1>
  <input type="text" id="nam"/>
  <input type="submit" value="ENTRAR" />
</form>

<form class="chat-form" method="post" action="">
 <h1> <div>OLÁ, <span id="username"></span></div></h1>
  <input id="recipient" value="TV"  />
  <input id="use" />
  <label>OPINIÃO: </label><br />
  <textarea id="message"></textarea>
  <input type="submit" value="Send" />

  <ul id="messages">

  </ul>
</form>

<script src="lib/jquery-1.9.1.min.js"></script>
<script src="lib/socket.io-1.2.0.js"></script>
<script>
  var socket = io.connect('http://localhost:3000');

  // Add a username
  $(".username-form").on("submit", function(){

    // Tell the server about it
    var username = $(this).children("#nam").val();
    socket.emit("add-user", {"username": username});

    // Remove this form and show the chat form
    $(this).remove();
    $("#username").text(username);
    $("#use").val(username);
   
    chat_form.show();
    return false;
  });

  // Chat form
 var chat_form = $(".chat-form");

 chat_form.on("submit", function(){

   // Send the message to the server
   socket.emit("private-message", {
    "username": $("#recipient").val(),
    "content": $(this).find("textarea").val(),
    "origin" : $("#use").val()
   });

   // Empty the form
   $(this).find("textarea").val('');
  return false;
 });

 // Whenever we receieve a message, append it to the <ul>
 socket.on("add-message", function(data){
  $("#messages").append($("<li>", {
    "text": data.content
  }));
 });

  socket.on("public", function(data){
    alert(data.content);  
 });
</script>
</body>
</html>